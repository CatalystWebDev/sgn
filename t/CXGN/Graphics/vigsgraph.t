
use strict;

use Test::More qw | no_plan |;
use Data::Dumper;
use CXGN::Graphics::VigsGraph;

my $vg = CXGN::Graphics::VigsGraph->new();

$vg->bwafile('t/data/vigstool/bwafile');

#$vg->seq_window_size(300);

$vg->query_seq(<<SEQ);
GTGGCTTAGTAGTTTGTAGGAGTAGGAATAGTCTTTTCTTGATCTGAGGGGTTTTTGGTT
TGGTTTTCCTGAATCAAGTCACTTGTGGTTGGCTTGTAACTTGTAAAGATTGAATCTTTA
TACATTTTTTCATCTGGGGTTGGCTTATATTTTGTGAAGATTGAATCTTTATAGGAATTT
TCATCTGGGGTTGGCTTATGTTTTGTGAAGATTGGATCTTTATAGGATTTACTACCTGGG
GTGGCCTTATATTTTGTAAAGATTGAAGCTTTATTGGATTTTTTTAAAATCTGGGGTTGG
CTTATGTTTTGTGTAGAGTTGTATTTGGAATGTTAGATTAGTGAACTATATCTGGGTTTG
GCTGTGAAGATTGAACCTAACTATTATTATCAACAGTAGATTACTTAGGTGTTGTGTGGT
TTGCCGATGGCTCGGTTGATTCTGCCTTGCAAGGGTTCGAGTTTGTCGAAGACGTGTCTC
TTGGGTTTGATCTCCAATAGAGCTTTTCAGGCAAGTTGCCGTGTTACTTCAGTTGGGCGC
TCGAGGGATATCTGCAGATACAAAAAATACCTTACTTCAGAGGTTGCGCATTGGAGGAGG
TGTCAAATCCCGCGTTTTCCATTAGTTCAACCTAGAAGAATTGACCGGAGATTAATCTGT
TCAGTTGCAACTGAACCTCTACCAAAAGAAGTTGAAGAATCCAAGATGGAAGCACCAAAG
GAAATCTTTCTGAAGGATTACAAACAACCTGATTACTATTTTGACACGTTGGATCTGAAA
TTCGCACTGGGTGAGGAAAGTACTATTGTCGCTTCCAAAATTGCTGTCAACCCCAGAGTT
GAAGGTCAGTCTTTCCCACTTGTCCTAGATGGGCGAGATCTGAAGTTGCAATCAGTTAAG
    ATCAACGGCAATCCGCTGAAGGAGGAAGATTTCCTCGTGGACTCGCGCCACCTGACTCTG
AAATCCCCTCCAAGTAGCAAATTCACCTTGGAGATTGTGACAGAAATACATCCTCAGAAG
AACACATCCTTAGAGGGTCTTTACAAGTCATCAGGGAATTTCTGCACCCAATGTGAGGCT
GAGGGTTTCCGTAAGATTACGTTCTATCAGGATCGCCCTGACATTATGGCAAAATACACT
TGTCGCATAGAGGCAGACAAATCCTTGTATCCTGTATTGTTGTCAAATGGAAACCTTATA
GAGCAAGGGGATCTGGAGGGAGGAAAGCATTATACTCTTTGGGAGGATCCTTTCAAGAAG
CCCAGTTATCTTTTTGCATTGGTTGCTGGTCAGTTGGTGAGCAGAGATGACACATTTACA
ACCTGTTCAGGCCGTAAGGTCTCCCTTAGAATCTGGACCCCTGCACAAGATCTGCCCAAG
ACAGAACATGCCATGTATTCTCTCAAGGCAGCTATGAAGTGGGATGAAGATGTTTTCGGG
CGGGAGTATGACCTGGATCTTTTTAATATTGTTGCTGTTCCAGATTTTAACATGGGAGCA
ATGGAAAACAAGAGCTTGAATATATTCAATTCCAAGCTTGTCCTGGCATCCCCAGAAACT
GCAACAGATGCTGATTATGCGGCTATATTGGGTGTGATTGGACATGAGTACTTCCACAAT
TGGACAGGCAACAGAGTTACATGTCGTGACTGGTTCCAGCTCAGTTTAAAGGAAGGACTT
ACTGTTTTCCGTGATCAGGAGTTTTCGTCTGATTTGGGCAGCCGTCCTGTGAAAAGAATT
GCTGATGTCTCAAAGCTTCGAATGTATCAGTTCCCGCAGGATGCTGGTCCAATGGCTCAT
CCTGTAAGGCCTCACTCTTATATAAAGATGGATAACTTCTACACAGTTACGGTATATGAG
AAGGGAGCTGAAGTGGTCAGGATGTACAAAACCTTGTTAGGTAGCCAAGGATTTAGAAAA
GGCACAGATTTATATTTTGAGAGGCATGATGGTCAAGCAGTAACATGTGAAGACTTTTTT
GCTGCCATGCGAGATGCCAACAATGCAGATTTTGCTAATTTCTTGTTATGGTACTCGCAA
GCTGGGACACCTGTAGTGAAGGTTACCACAAATTATAATGCTGAAGGGCGCACTTTCTCC
CTCAAGTTTAGTCAAGAGGTGCCTCCAACCCCCGGCCAGTCTGCAAAAGAACCTATGTTT
ATTCCTGTTGCTGTAGGTCTGCTGGATTCAAGTGGTAAGGACATGCCTCTATCTTCGGTT
CATCATGATGGGAAATTGGAGAGTTTTGCGAGCAGTGGTCAAAACGTATACACCACAGTT
CTCCGCGTAACGAAGAAGGAGGAGGAATTTGTGTTCAATGACGTATCTGAGAGGCCAACA
CCATCGATATTGCGAGGATTCAGTGCTCCCATCAGGCTTGAGTCTGATCTCACTGATAGT
GATCTTCTTTTCCTTCTTGCTCATGATTCTGATGAGTTTAACCGGTGGGAGGCGGGACAA
GTGTTGGCAAGGAAGTTGATGCTCAGTCTGGTAGCTGATTTCCAACAGAATAAGGCTTTG
GTTCTTAACCCTCAGTTTTTGCAGGGGATCAAAAGCATACTCACCGACTCAAGCTTGGAT
AAGGAATTCATTGCAAAGGCAATAACTTTGCCTGGTATAGGAGAAATCATGGACATGATG
ACGGTTGCTGATCCAGATGCCGTTCATGCAGTGCGGACTTTCATCAGGAAGCAACTGGCT
TCTGAATTGAAACAAGAGTTCCTTATCACTGCTAAAAACAACAGGAGCTCTGGTGCTTAT
GAGTTTGATCATAACAATATGGCACGTCGTGCTCTTAAAAATATTGCTCTTGCTTATCTT
GGATCACTTGAAAACCCAGAAATCACAGAACTTCTATTGAATGAATACAGAAACGCCACA
AACATGACAGATCAGTTTGCAGCTTTAGTGGCTATCGATCAGCAACCTGCAATTCGTGAA
GAAATTTTGGCTGATTTCTATAACAAGTGGCAGGATGATTACTTGGTTGTGAACAAGTGG
CTTGCTCTTCAAGCTATGTCAGACATGCCTGGTAATGTTGAGAATGTCAAGAAACTTCTA
AACCATACAGCCTTTGACCTATGTAATCCAAATAAGGTTTATTCGTTGATCGGAGGATTT
TGTGGTTCACCTGTCAACTTCCATAGCAAGGATGGCTCCGGCTACAAGTTCTTGGGAGAA
CTAGTGGTGAAGCTTGACAAGATGAATCCACAGGTGGCTTCACGAATGGTTTCAGCGTTC
TCCAGGTGGAAACGTTATGATGAAACAAGACAGAGTCTCGCGAAGGAACAATTGGAGATG
ATCTTGTCTACTGAGGGACTCTCAGAGAATGTGTTTGAAATCGCATCGAAGAGCTTGGCA
GCTTGATTTTTATATTTTTGGTTTCATTTTTCAGTTATTTGAACCGTGCTCTATTTGTTC
CAAAGAGTTTATAATTATGTAATGGTTTCAGTAAACATTAAAACTTAGTTACACTTAGTG
ATATTCATACCTGCGATTTGCATT
SEQ

ok( ref($vg->parse()), "parse result test");

my $matches = $vg->matches();

is(scalar(keys(%$matches)), 57, "match count");


#$vg->seq_window_size(200);
##my @seqs = $vg->get_best_vigs_seqs(1);

my ($best, $regions) = $vg->get_best_coverage();

is($best, 1, "coverage test");

$vg->render("/tmp/vigs_test.png", 1);

ok(-s "/tmp/vigs_test.png" > 0, "image file size");

my @targets = $vg->target_graph(1);
#print STDERR join ",", @targets;
is($targets[1], 1, "target array test 1");
is($targets[22], 21, "target array test 2");
is($targets[-1], 1, "target array test 3");

my @off_targets = $vg->off_target_graph(1);
#print STDERR join ",", @off_targets;
is($off_targets[0], undef, "off target array test 1");
is($off_targets[100], 4, "off target array test 2");
is($off_targets[-1], 3, "off target array test 3");

#print STDERR "\n";

my @regions = $vg ->longest_vigs_sequence(1);
#print Dumper(\@regions);
is($regions[0]->[4], 2312, "best region start coord test");
is($regions[0]->[5], 2569, "best region end coord test");








