
<%args>



</%args>

<& /page/page_title.mas, title=>"Download using lists" &>

Choose a list for each parameter and click "download".
<br /><br />

<center>
<form id="download_form" action="/breeders/download_action" method="POST" >
<table cellpadding="10">
  <tr>
    <th>
      Accessions
    </th>
    <th>
      Trials
    </th>
    <th>
      Traits
    </th>
  </tr>

  <tr>
    <td>
      <div id="accession_list">
      </div>
      
    </td>
    <td>
      <div id="trial_list">
      </div>
    </td>
    <td>
      <div id="trait_list">
      </div>
    </td>
  </tr>
  <tr><td colspan="3"><h4>Output</h4><input type="radio" id="output_selection" name="output_selection" value="phenotypes" disabled="1" checked="1" /> Phenotypes<br />
                      <input type="radio" id="output_selection" name="output_selection" value="genotypes" disabled="1" /> Genotypes<br /></td></tr>
</table>
<br />
<br />
<input type="button" id="download_submission" value="Download" />
</form>
</center>


<script>
  
  jQuery(document).ready(function() { 
    var lo = new CXGN.List();
    var accession_list_select = lo.listSelect('accession_list', [ 'accessions' ], 1);
    //alert(accession_list_select);
    jQuery('#accession_list').html(accession_list_select);
    jQuery('#trial_list').html(lo.listSelect('trial_list', [ 'trials' ], 1 ));
    jQuery('#trait_list').html(lo.listSelect('trait_list', [ 'traits' ], 1 ));

    jQuery('#download_submission').click(function() {
      var lo = new CXGN.List();
      var accession_list_id = jQuery('#accession_list_list_select').val();
      var trial_list_id = jQuery('#trial_list_list_select').val();
      var trait_list_id = jQuery('#trait_list_list_select').val();

      var accession_validation = 0;
      var trial_validation = 0;
      var trait_validation = 0;
  
      if (accession_list_id > 0) { 
         accession_validation = lo.validate(accession_list_id, 'accessions', true);
      }
      if (trial_list_id > 0) { 
         trial_validation = lo.validate(trial_list_id, 'trials', true);
      }
      if (trait_list_id > 0) { 
         trait_validation = lo.validate(trait_list_id, 'traits', true);
      }

//    if (!accession_list_id || ! trial_list_id || ! trait_list_id) { 
//       alert("You need to select an accession, a trail, and a trait list!");
//       return; 
//    }

      var problem_lists = new Array();

      if (accession_list_id && accession_validation != 1) { 
        problem_lists.push('accessions');
      }
      if (trial_list_id && trial_validation != 1) { 
        problem_lists.push('trials');
      }
      if (trait_list_id && trait_validation != 1) { 
        problem_lists.push('traits');
      }

      if (problem_lists.length > 0) { 
        alert("The following lists did not pass validation: "+problem_lists.join(", ")+". Please correct the list(s) and try again");
        return;
      }
        
      jQuery('#download_form').submit();
  
    });


  });


  
</script>
